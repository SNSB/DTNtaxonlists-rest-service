{% extends "layout.html" %}
{% block body %}
<h2>Verf&uuml;gbare Listen auf diesem Server:</h2>

<script>
$.ajaxSetup({
    async: false
});
$.getJSON("{{ url_for('taxonlists', __external=T) }}", function(data) {
    var items = [];
    $.each( data, function( listentry ) {
        var listobject =  data[listentry]
        var projectlink = ""
        var listlink =""
        $.each( listobject.links, function (linkindex) {
            if (listobject.links[linkindex].name == 'listproject') {
                projectlink=listobject.links[linkindex]["uri"];
            };
            if (listobject.links[linkindex].name == 'taxonnamelist') {
                listlink=listobject.links[linkindex]["uri"];
            };
        });
        var projectname = ""
        var projectdescr = ""
        var agentlink = ""
        var agentitems = [];
        $.getJSON(URI.parse(projectlink).path, function(projectlist) {
            $.each( projectlist, function (projectlistindex) {
                projectname = projectlist[projectlistindex].Project;
                console.log("Project:"+projectname);
                projectdescr = projectlist[projectlistindex].ProjectTitle;
                $.each(projectlist[projectlistindex].links, function (pali) {
                    if (projectlist[projectlistindex].links[pali].name=='agents') {
                        agentlink = projectlist[projectlistindex].links[pali].uri;
                    };
                });
            });
            $.getJSON(URI.parse(agentlink).path, function(agents) {
                $.each(agents, function(agentsindex) {
                    if (agents[agentsindex].AgentRole == 'editor') {
                        agentitems.push(agents[agentsindex].AgentName);
                    };
                });
            });    
        });
        items.push( "<li id='Database'> <a href='" + URI.parse(listlink).path + "www'>" + projectname + "</a> <ul><li class='projectdescription'>" + projectdescr + "</li><li class='dbname'>In: " + listobject.DatabaseName + "</li> <li class='curator'> Curator: <ul><li class='person'>"+ agentitems.join("</li><li class='person'>") + "</li></ul></li></ul> </li>" );
    });

    $( "<ul/>", {
        "class": "my-new-list",
        html: items.join( "" )
        }).appendTo( "body" );
});   
</script>

{% endblock %}
